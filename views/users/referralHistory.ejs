<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Referral History - LapTique</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/referralHistory.css">
</head>
<body>
    <%-include("../../views/parsuals/user/header")%>
    <div style="margin-top: 70px;"></div>
    <div class="referral-container">
        <!-- Hero Section -->
        <div class="referral-hero">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <h1 class="hero-title">
                            <i class="fas fa-gift me-3"></i>Refer & Earn Rewards
                        </h1>
                        <p class="hero-subtitle">Invite your friends and earn ₹100 wallet cash when they make their first purchase!</p>
                    </div>
                    <div class="col-lg-6 text-end">
                        <div class="stats-card">
                            <div class="stat-item">
                                <h2 class="stat-number"><%= totalReferrals %></h2>
                                <p class="stat-label">Total Referrals</p>
                            </div>
                            <div class="stat-divider"></div>
                            <div class="stat-item">
                                <h2 class="stat-number">₹<%= totalReferrals * 100 %></h2>
                                <p class="stat-label">Rewards Earned</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container mt-5">
            <div class="row">
                <!-- Left Column - Referral Tools -->
                <div class="col-lg-4 mb-4">
                    <!-- Referral Code Card -->
                    <div class="referral-card">
                        <div class="card-icon">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <h5 class="card-title">Your Referral Code</h5>
                        <div class="referral-code-display">
                            <%= referralCode %>
                        </div>
                        <button class="btn-copy" onclick="copyCode()">
                            <i class="fas fa-copy me-2"></i>Copy Code
                        </button>
                    </div>

                    <!-- Referral Link Card -->
                    <div class="referral-card">
                        <div class="card-icon">
                            <i class="fas fa-link"></i>
                        </div>
                        <h5 class="card-title">Share Your Link</h5>
                        <div class="referral-link-display">
                            <%= referralLink %>
                        </div>
                        <button class="btn-copy" onclick="copyLink()">
                            <i class="fas fa-link me-2"></i>Copy Link
                        </button>
                    </div>

                    <!-- Share Options -->
                    <div class="referral-card">
                        <div class="card-icon">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <h5 class="card-title">Share Via</h5>
                        <div class="share-buttons">
                            <button class="share-btn whatsapp" onclick="shareWhatsApp()">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                            <button class="share-btn facebook" onclick="shareFacebook()">
                                <i class="fab fa-facebook-f"></i>
                            </button>
                            <button class="share-btn twitter" onclick="shareTwitter()">
                                <i class="fab fa-twitter"></i>
                            </button>
                            <button class="share-btn email" onclick="shareEmail()">
                                <i class="fas fa-envelope"></i>
                            </button>
                        </div>
                    </div>

                    <!-- How It Works -->
                    <div class="referral-card">
                        <div class="card-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <h5 class="card-title">How It Works</h5>
                        <div class="steps">
                            <div class="step">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h6>Share Your Code</h6>
                                    <p>Share your unique referral code or link with friends</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h6>Friend Registers</h6>
                                    <p>Your friend signs up using your referral code</p>
                                </div>
                            </div>
                            <div class="step">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h6>Get Rewards</h6>
                                    <p>Receive ₹100 in wallet when they place their first order</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Referral History -->
                <div class="col-lg-8">
                    <!-- Referral List -->
                    <div class="referral-card">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-users me-2"></i>Your Referrals
                            </h5>
                            <span class="badge bg-success"><%= totalReferrals %> Total</span>
                        </div>

                        <% if (referrals && referrals.length > 0) { %>
                            <div class="referral-list">
                                <% referrals.forEach((referral, index) => { %>
                                    <div class="referral-item">
                                        <div class="referral-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="referral-info">
                                            <h6 class="referral-name"><%= referral.userId.name %></h6>
                                            <p class="referral-email"><%= referral.userId.email %></p>
                                            <small class="referral-date">
                                                <i class="fas fa-calendar me-1"></i>
                                                Joined <%= new Date(referral.registeredOn).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' }) %>
                                            </small>
                                        </div>
                                        <div class="referral-status">
                                            <% if (referral.rewardGiven) { %>
                                                <span class="status-badge success">
                                                    <i class="fas fa-check-circle me-1"></i>Rewarded
                                                </span>
                                            <% } else { %>
                                                <span class="status-badge pending">
                                                    <i class="fas fa-clock me-1"></i>Pending
                                                </span>
                                            <% } %>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        <% } else { %>
                            <div class="empty-state">
                                <i class="fas fa-users fa-4x mb-3"></i>
                                <h5>No Referrals Yet</h5>
                                <p>Start sharing your referral code to earn rewards!</p>
                                <button class="btn btn-primary mt-3" onclick="copyCode()">
                                    <i class="fas fa-copy me-2"></i>Copy Referral Code
                                </button>
                            </div>
                        <% } %>
                    </div>

                    <!-- Rewards Summary -->
                    <div class="referral-card mt-4">
                        <h5 class="card-title mb-4">
                            <i class="fas fa-trophy me-2"></i>Your Rewards
                        </h5>
                        
                        <div class="rewards-summary">
                            <div class="reward-item wallet-reward">
                                <div class="reward-icon">
                                    <i class="fas fa-wallet"></i>
                                </div>
                                <div class="reward-details">
                                    <h6>Wallet Credits</h6>
                                    <p class="reward-amount">₹<%= totalReferrals * 100 %></p>
                                    <small>₹100 per successful referral</small>
                                </div>
                            </div>
                            
                            <div class="reward-item coupon-reward">
                                <div class="reward-icon">
                                    <i class="fas fa-ticket-alt"></i>
                                </div>
                                <div class="reward-details">
                                    <h6>Bonus Coupons</h6>
                                    <p class="reward-amount"><%= referralCoupons ? referralCoupons.length : 0 %> Coupons</p>
                                    <small>₹50 bonus per referral</small>
                                </div>
                            </div>
                        </div>

                        <% if (referralCoupons && referralCoupons.length > 0) { %>
                            <hr class="my-4">
                            <h6 class="mb-3">Available Bonus Coupons</h6>
                            <div class="coupon-grid">
                                <% referralCoupons.forEach(coupon => { %>
                                    <div class="coupon-card">
                                        <div class="coupon-header">
                                            <i class="fas fa-gift"></i>
                                        </div>
                                        <div class="coupon-body">
                                            <h6 class="coupon-code"><%= coupon.name %></h6>
                                            <p class="coupon-value">₹<%= coupon.discountValue %> OFF</p>
                                            <p class="coupon-desc"><%= coupon.description %></p>
                                            <small class="coupon-expiry">
                                                Expires: <%= new Date(coupon.expireOn).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' }) %>
                                            </small>
                                        </div>
                                    </div>
                                <% }) %>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const referralCode = '<%= referralCode %>';
        const referralLink = '<%= referralLink %>';

        function copyCode() {
            navigator.clipboard.writeText(referralCode).then(() => {
                showToast('Referral code copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        function copyLink() {
            navigator.clipboard.writeText(referralLink).then(() => {
                showToast('Referral link copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        function shareWhatsApp() {
            const message = `Hey! Join LapTique using my referral code ${referralCode} and get amazing deals on laptops! ${referralLink}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
        }

        function shareFacebook() {
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralLink)}`, '_blank');
        }

        function shareTwitter() {
            const message = `Join LapTique using my referral code ${referralCode} and get amazing deals!`;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(message)}&url=${encodeURIComponent(referralLink)}`, '_blank');
        }

        function shareEmail() {
            const subject = 'Join LapTique - Premium Laptop Store';
            const body = `Hey!\n\nI'm inviting you to join LapTique, an amazing laptop store. Use my referral code ${referralCode} when you sign up!\n\nRegister here: ${referralLink}\n\nHappy Shopping!`;
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'custom-toast';
            toast.innerHTML = `<i class="fas fa-check-circle me-2"></i>${message}`;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
    </script>
    <%-include("../../views/parsuals/user/footer")%>
</body>
</html>
