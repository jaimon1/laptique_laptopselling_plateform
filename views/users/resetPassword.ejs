<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password</title>
    <link rel="stylesheet" href="/css/resetPassword.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="page-container">
        <div class="logo">LAPTIQUE</div>
        
        <div class="left-section">
            <div class="left-content">
                <h2>Create New Password</h2>
                <p>Choose a strong password to keep your account secure and protected.</p>
            </div>
        </div>

        <div class="right-section">
            <div class="form-card">
            <h1>Enter New Password</h1>
            <p class="subtitle">Create a strong password for your account</p>
            
            <% if (typeof msg !== 'undefined' && msg) { %>
            <div class="alert alert-danger">
                <%= msg %>
            </div>
            <% } %>

            <% if (typeof success !== 'undefined' && success) { %>
            <div class="alert alert-success">
                <%= success %>
            </div>
            <% } %>

            <form action="/reset-password-with-otp" method="post" id="resetPasswordForm">
                <div class="form-group">
                    <label for="password">New Password</label>
                    <input type="password" name="password" class="form-control" id="password" placeholder="New password" required>
                    <div id="passwordStrength" class="password-strength"></div>
                    <div id="errorPassword" class="error-message"></div>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" name="confirmPassword" class="form-control" id="confirmPassword" placeholder="Confirm password" required>
                    <div id="errorConfirmPassword" class="error-message"></div>
                </div>
                
                <button type="submit" class="btn-primary" id="submitBtn">Reset Password</button>
            </form>

            <div class="back-link">
                <a href="/login">Back to Login</a>
            </div>
            </div>
        </div>
    </div>

    <script>
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const errorPassword = document.getElementById('errorPassword');
        const errorConfirmPassword = document.getElementById('errorConfirmPassword');
        const passwordStrength = document.getElementById('passwordStrength');
        const resetPasswordForm = document.getElementById('resetPasswordForm');
        const submitBtn = document.getElementById('submitBtn');

        function checkPasswordStrength(password) {
            let strength = 0;
            let feedback = [];

            if (password.length >= 8) strength++;
            else feedback.push("at least 8 characters");

            if (/[a-z]/.test(password)) strength++;
            else feedback.push("lowercase letter");

            if (/[A-Z]/.test(password)) strength++;
            else feedback.push("uppercase letter");

            if (/[0-9]/.test(password)) strength++;
            else feedback.push("number");

            if (/[^A-Za-z0-9]/.test(password)) strength++;
            else feedback.push("special character");

            return { strength, feedback };
        }

        function passwordValidation() {
            const password = passwordInput.value.trim();
            const { strength, feedback } = checkPasswordStrength(password);

            if (password.length < 8) {
                errorPassword.style.display = "block";
                errorPassword.innerHTML = "Password must be at least 8 characters";
                passwordStrength.innerHTML = "";
                return false;
            } else {
                errorPassword.style.display = "none";
                errorPassword.innerHTML = "";

       
                if (strength <= 2) {
                    passwordStrength.innerHTML = "Weak password";
                    passwordStrength.className = "password-strength strength-weak";
                } else if (strength <= 4) {
                    passwordStrength.innerHTML = "Medium strength";
                    passwordStrength.className = "password-strength strength-medium";
                } else {
                    passwordStrength.innerHTML = "Strong password";
                    passwordStrength.className = "password-strength strength-strong";
                }

                if (feedback.length > 0) {
                    passwordStrength.innerHTML += ` (Missing: ${feedback.join(', ')})`;
                }

                return true;
            }
        }

        function confirmPasswordValidation() {
            const password = passwordInput.value.trim();
            const confirmPassword = confirmPasswordInput.value.trim();

            if (password !== confirmPassword) {
                errorConfirmPassword.style.display = "block";
                errorConfirmPassword.innerHTML = "Passwords do not match";
                return false;
            } else {
                errorConfirmPassword.style.display = "none";
                errorConfirmPassword.innerHTML = "";
                return true;
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            resetPasswordForm.addEventListener('submit', (e) => {
                const isPasswordValid = passwordValidation();
                const isConfirmPasswordValid = confirmPasswordValidation();

                if (!isPasswordValid || !isConfirmPasswordValid) {
                    e.preventDefault();
                } else {
                 
                    submitBtn.innerHTML = 'Resetting...';
                    submitBtn.disabled = true;
                }
            });

            passwordInput.addEventListener('input', passwordValidation);
            confirmPasswordInput.addEventListener('input', confirmPasswordValidation);
        });
    </script>
</body>

</html>